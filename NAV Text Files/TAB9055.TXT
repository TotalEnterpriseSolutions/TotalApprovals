OBJECT Table 9055 Purchase Cue
{
  OBJECT-PROPERTIES
  {
    Date=18/10/17;
    Time=16:44:08;
    Modified=Yes;
    Version List=NAVW18.00,TA1.0;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Purchase Cue;
               ENG=Purchase Cue];
  }
  FIELDS
  {
    { 1   ;   ;Primary Key         ;Code10        ;CaptionML=[ENU=Primary Key;
                                                              ENG=Primary Key] }
    { 2   ;   ;To Send or Confirm  ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order),
                                                                                              Status=FILTER(Open),
                                                                                              Responsibility Center=FIELD(Responsibility Center Filter)));
                                                   CaptionML=[ENU=To Send or Confirm;
                                                              ENG=To Send or Confirm];
                                                   Editable=No }
    { 3   ;   ;Upcoming Orders     ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order),
                                                                                              Status=FILTER(Released),
                                                                                              Expected Receipt Date=FIELD(Date Filter),
                                                                                              Responsibility Center=FIELD(Responsibility Center Filter)));
                                                   AccessByPermission=TableData 120=R;
                                                   CaptionML=[ENU=Upcoming Orders;
                                                              ENG=Upcoming Orders];
                                                   Editable=No }
    { 4   ;   ;Outstanding Purchase Orders;Integer;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order),
                                                                                              Status=FILTER(Released),
                                                                                              Completely Received=FILTER(No),
                                                                                              Responsibility Center=FIELD(Responsibility Center Filter)));
                                                   AccessByPermission=TableData 120=R;
                                                   CaptionML=[ENU=Outstanding Purchase Orders;
                                                              ENG=Outstanding Purchase Orders];
                                                   Editable=No }
    { 5   ;   ;Purchase Return Orders - All;Integer;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Return Order),
                                                                                              Responsibility Center=FIELD(Responsibility Center Filter)));
                                                   AccessByPermission=TableData 6650=R;
                                                   CaptionML=[ENU=Purchase Return Orders - All;
                                                              ENG=Purchase Return Orders - All];
                                                   Editable=No }
    { 6   ;   ;Not Invoiced        ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order),
                                                                                              Completely Received=FILTER(Yes),
                                                                                              Invoice=FILTER(No),
                                                                                              Responsibility Center=FIELD(Responsibility Center Filter)));
                                                   AccessByPermission=TableData 120=R;
                                                   CaptionML=[ENU=Not Invoiced;
                                                              ENG=Not Invoiced];
                                                   Editable=No }
    { 7   ;   ;Partially Invoiced  ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order),
                                                                                              Completely Received=FILTER(Yes),
                                                                                              Invoice=FILTER(Yes),
                                                                                              Responsibility Center=FIELD(Responsibility Center Filter)));
                                                   AccessByPermission=TableData 120=R;
                                                   CaptionML=[ENU=Partially Invoiced;
                                                              ENG=Partially Invoiced];
                                                   Editable=No }
    { 20  ;   ;Date Filter         ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Date Filter;
                                                              ENG=Date Filter];
                                                   Editable=No }
    { 21  ;   ;Responsibility Center Filter;Code10;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Responsibility Center Filter;
                                                              ENG=Responsibility Centre Filter];
                                                   Editable=No }
    { 81000;  ;User ID Filter      ;Code50        ;FieldClass=FlowFilter;
                                                   Description=TA1.0;
                                                   Editable=No }
    { 81001;  ;Open                ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order),
                                                                                              Originator=FIELD(User ID Filter),
                                                                                              Status=FILTER(Open|Rejected),
                                                                                              Deleted=CONST(No)));
                                                   BlankZero=Yes;
                                                   Description=TA1.0 }
    { 81002;  ;Pending Approval    ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order|Credit Memo),
                                                                                              Originator=FIELD(User ID Filter),
                                                                                              Status=FILTER(Pending Approval),
                                                                                              Deleted=CONST(No)));
                                                   Description=TA1.0 }
    { 81003;  ;Pending Receipt     ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order),
                                                                                              Status=FILTER(Released),
                                                                                              Completely Received=CONST(No),
                                                                                              Deleted=CONST(No),
                                                                                              Originator=FIELD(User ID Filter)));
                                                   OnLookup=VAR
                                                              UserSetup@1000000000 : Record 91;
                                                            BEGIN
                                                              UserSetup.GET(USERID);
                                                              LocationCode := UserSetup."Default Location";
                                                            END;

                                                   Description=TA1.0 }
    { 81004;  ;Approved            ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order),
                                                                                              Originator=FIELD(User ID Filter),
                                                                                              Status=FILTER(Released),
                                                                                              Deleted=CONST(No)));
                                                   Description=TA1.0 }
    { 81005;  ;Approval Entries    ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Approval Entry" WHERE (Status=FILTER(Open),
                                                                                             Document Type=FILTER(<>' '),
                                                                                             Approval Code=FILTER(<>EXPENSE)));
                                                   TableRelation="Approval Entry";
                                                   Description=TA1.0;
                                                   Editable=No }
    { 81006;  ;Requests to Approve ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Approval Entry" WHERE (Approver ID=FIELD(User ID Filter),
                                                                                             Status=CONST(Open),
                                                                                             Approval Code=FILTER(<>EXPENSE)));
                                                   CaptionML=[ENU=Requests to Approve;
                                                              ENG=Requests to Approve];
                                                   Description=TA1.0 }
    { 81007;  ;Requests Sent for Approval;Integer ;FieldClass=FlowField;
                                                   CalcFormula=Count("Approval Entry" WHERE (Sender ID=FIELD(User ID Filter),
                                                                                             Status=FILTER(Open),
                                                                                             Approval Code=FILTER(<>EXPENSE)));
                                                   CaptionML=[ENU=Requests Sent for Approval;
                                                              ENG=Requests Sent for Approval];
                                                   Description=TA1.0 }
    { 81008;  ;Open Overview       ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order),
                                                                                              Status=FILTER(Open|Rejected),
                                                                                              Deleted=CONST(No)));
                                                   BlankZero=Yes;
                                                   Description=TA1.0 }
    { 81009;  ;Pending Approval Overview;Integer  ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order|Credit Memo),
                                                                                              Status=FILTER(Pending Approval),
                                                                                              Deleted=CONST(No)));
                                                   Description=TA1.0 }
    { 81010;  ;Approved Overview   ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Purchase Header" WHERE (Document Type=FILTER(Order),
                                                                                              Status=FILTER(Released),
                                                                                              Deleted=CONST(No)));
                                                   Description=TA1.0 }
    { 81011;  ;Expenses - Pending  ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("EM Approval Entry" WHERE (Approver ID=FIELD(User ID Filter)));
                                                   CaptionML=ENU=Expenses - Pending;
                                                   Description=SIG1.0;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Primary Key                             ;Clustered=Yes }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      LocationCode@1000000000 : Code[20];

    PROCEDURE SetRespCenterFilter@1();
    VAR
      UserSetupMgt@1000 : Codeunit 5700;
      RespCenterCode@1001 : Code[10];
    BEGIN
      RespCenterCode := UserSetupMgt.GetPurchasesFilter;
      IF RespCenterCode <> '' THEN BEGIN
        FILTERGROUP(2);
        SETRANGE("Responsibility Center Filter",RespCenterCode);
        FILTERGROUP(0);
      END;
    END;

    PROCEDURE CountOrders@5(FieldNumber@1000 : Integer) : Integer;
    VAR
      CountPurchOrders@1001 : Query 9063;
    BEGIN
      CASE FieldNumber OF
        FIELDNO("Outstanding Purchase Orders"):
          BEGIN
            CountPurchOrders.SETRANGE(Status,CountPurchOrders.Status::Released);
            CountPurchOrders.SETRANGE(Completely_Received,FALSE);
            CountPurchOrders.SETRANGE(Invoice);
          END;
        FIELDNO("Not Invoiced"):
          BEGIN
            CountPurchOrders.SETRANGE(Status);
            CountPurchOrders.SETRANGE(Completely_Received,TRUE);
            CountPurchOrders.SETRANGE(Invoice,FALSE);
          END;
        FIELDNO("Partially Invoiced"):
          BEGIN
            CountPurchOrders.SETRANGE(Status);
            CountPurchOrders.SETRANGE(Completely_Received,TRUE);
            CountPurchOrders.SETRANGE(Invoice,TRUE);
          END;
      END;
      FILTERGROUP(2);
      CountPurchOrders.SETFILTER(Responsibility_Center,GETFILTER("Responsibility Center Filter"));
      FILTERGROUP(0);
      CountPurchOrders.OPEN;
      CountPurchOrders.READ;
      EXIT(CountPurchOrders.Count_Orders);
    END;

    PROCEDURE ShowOrders@2(FieldNumber@1001 : Integer);
    VAR
      PurchHeader@1000 : Record 38;
    BEGIN
      PurchHeader.SETRANGE("Document Type",PurchHeader."Document Type"::Order);
      CASE FieldNumber OF
        FIELDNO("Outstanding Purchase Orders"):
          BEGIN
            PurchHeader.SETRANGE(Status,PurchHeader.Status::Released);
            PurchHeader.SETRANGE("Completely Received",FALSE);
            PurchHeader.SETRANGE(Invoice);
          END;
        FIELDNO("Not Invoiced"):
          BEGIN
            PurchHeader.SETRANGE(Status);
            PurchHeader.SETRANGE("Completely Received",TRUE);
            PurchHeader.SETRANGE(Invoice,FALSE);
          END;
        FIELDNO("Partially Invoiced"):
          BEGIN
            PurchHeader.SETRANGE(Status);
            PurchHeader.SETRANGE("Completely Received",TRUE);
            PurchHeader.SETRANGE(Invoice,TRUE);
          END;
      END;
      FILTERGROUP(2);
      PurchHeader.SETFILTER("Responsibility Center",GETFILTER("Responsibility Center Filter"));
      FILTERGROUP(0);
      PAGE.RUN(PAGE::"Purchase Order List",PurchHeader);
    END;

    BEGIN
    END.
  }
}

